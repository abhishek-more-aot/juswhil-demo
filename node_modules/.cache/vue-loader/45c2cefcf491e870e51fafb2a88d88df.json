{"remainingRequest":"/home/algoocean/Desktop/AOT-Project/myvarni-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/algoocean/Desktop/AOT-Project/myvarni-admin/src/components/HeaderSearch/index.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/algoocean/Desktop/AOT-Project/myvarni-admin/src/components/HeaderSearch/index.vue","mtime":1668754947358},{"path":"/home/algoocean/Desktop/AOT-Project/myvarni-admin/node_modules/cache-loader/dist/cjs.js","mtime":1655274288430},{"path":"/home/algoocean/Desktop/AOT-Project/myvarni-admin/node_modules/babel-loader/lib/index.js","mtime":1668596430903},{"path":"/home/algoocean/Desktop/AOT-Project/myvarni-admin/node_modules/ts-loader/index.js","mtime":1650280622125},{"path":"/home/algoocean/Desktop/AOT-Project/myvarni-admin/node_modules/cache-loader/dist/cjs.js","mtime":1655274288430},{"path":"/home/algoocean/Desktop/AOT-Project/myvarni-admin/node_modules/vue-loader/lib/index.js","mtime":1668596436320}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnCmltcG9ydCBGdXNlIGZyb20gJ2Z1c2UuanMnIC8vIEEgbGlnaHR3ZWlnaHQgZnV6enktc2VhcmNoIG1vZHVsZQppbXBvcnQgeyBDb21wb25lbnQsIFZ1ZSwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJwppbXBvcnQgeyBSb3V0ZUNvbmZpZyB9IGZyb20gJ3Z1ZS1yb3V0ZXInCmltcG9ydCB7IEFwcE1vZHVsZSB9IGZyb20gJ0Avc3RvcmUvbW9kdWxlcy9hcHAnCmltcG9ydCB7IFBlcm1pc3Npb25Nb2R1bGUgfSBmcm9tICdAL3N0b3JlL21vZHVsZXMvcGVybWlzc2lvbicKaW1wb3J0IGkxOG4gZnJvbSAnQC9sYW5nJyAvLyBJbnRlcm5hdGlvbmFsaXphdGlvbgoKQENvbXBvbmVudCh7CiAgbmFtZTogJ0hlYWRlclNlYXJjaCcKfSkKZXhwb3J0IGRlZmF1bHQgY2xhc3MgZXh0ZW5kcyBWdWUgewogIHByaXZhdGUgc2VhcmNoID0gJyc7CiAgcHJpdmF0ZSBzaG93ID0gZmFsc2U7CiAgcHJpdmF0ZSBvcHRpb25zOiBSb3V0ZUNvbmZpZ1tdID0gW107CiAgcHJpdmF0ZSBzZWFyY2hQb29sOiBSb3V0ZUNvbmZpZ1tdID0gW107CiAgcHJpdmF0ZSBmdXNlPzogRnVzZTxSb3V0ZUNvbmZpZywge30+OwoKICBnZXQgcm91dGVzKCkgewogICAgcmV0dXJuIFBlcm1pc3Npb25Nb2R1bGUucm91dGVzCiAgfQoKICBnZXQgbGFuZygpIHsKICAgIHJldHVybiBBcHBNb2R1bGUubGFuZ3VhZ2UKICB9CgogIEBXYXRjaCgnbGFuZycpCiAgcHJpdmF0ZSBvbkxhbmdDaGFuZ2UoKSB7CiAgICB0aGlzLnNlYXJjaFBvb2wgPSB0aGlzLmdlbmVyYXRlUm91dGVzKHRoaXMucm91dGVzKQogIH0KCiAgQFdhdGNoKCdyb3V0ZXMnKQogIHByaXZhdGUgb25Sb3V0ZXNDaGFuZ2UoKSB7CiAgICB0aGlzLnNlYXJjaFBvb2wgPSB0aGlzLmdlbmVyYXRlUm91dGVzKHRoaXMucm91dGVzKQogIH0KCiAgQFdhdGNoKCdzZWFyY2hQb29sJykKICBwcml2YXRlIG9uU2VhcmNoUG9vbENoYW5nZSh2YWx1ZTogUm91dGVDb25maWdbXSkgewogICAgdGhpcy5pbml0RnVzZSh2YWx1ZSkKICB9CgogIEBXYXRjaCgnc2hvdycpCiAgcHJpdmF0ZSBvblNob3dDaGFuZ2UodmFsdWU6IGJvb2xlYW4pIHsKICAgIGlmICh2YWx1ZSkgewogICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbG9zZSkKICAgIH0gZWxzZSB7CiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsb3NlKQogICAgfQogIH0KCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuc2VhcmNoUG9vbCA9IHRoaXMuZ2VuZXJhdGVSb3V0ZXModGhpcy5yb3V0ZXMpCiAgfQoKICBwcml2YXRlIGNsaWNrKCkgewogICAgdGhpcy5zaG93ID0gIXRoaXMuc2hvdwogICAgaWYgKHRoaXMuc2hvdykgewogICAgICB0aGlzLiRyZWZzLmhlYWRlclNlYXJjaFNlbGVjdCAmJgogICAgICAgICh0aGlzLiRyZWZzLmhlYWRlclNlYXJjaFNlbGVjdCBhcyBIVE1MRWxlbWVudCkuZm9jdXMoKQogICAgfQogIH0KCiAgcHJpdmF0ZSBjbG9zZSgpIHsKICAgIHRoaXMuJHJlZnMuaGVhZGVyU2VhcmNoU2VsZWN0ICYmCiAgICAgICh0aGlzLiRyZWZzLmhlYWRlclNlYXJjaFNlbGVjdCBhcyBIVE1MRWxlbWVudCkuYmx1cigpCiAgICB0aGlzLm9wdGlvbnMgPSBbXQogICAgdGhpcy5zaG93ID0gZmFsc2UKICB9CgogIHByaXZhdGUgY2hhbmdlKHJvdXRlOiBSb3V0ZUNvbmZpZykgewogICAgdGhpcy4kcm91dGVyLnB1c2gocm91dGUucGF0aCkKICAgIHRoaXMuc2VhcmNoID0gJycKICAgIHRoaXMub3B0aW9ucyA9IFtdCiAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgIHRoaXMuc2hvdyA9IGZhbHNlCiAgICB9KQogIH0KCiAgcHJpdmF0ZSBpbml0RnVzZShsaXN0OiBSb3V0ZUNvbmZpZ1tdKSB7CiAgICB0aGlzLmZ1c2UgPSBuZXcgRnVzZShsaXN0LCB7CiAgICAgIHNob3VsZFNvcnQ6IHRydWUsCiAgICAgIHRocmVzaG9sZDogMC40LAogICAgICBsb2NhdGlvbjogMCwKICAgICAgZGlzdGFuY2U6IDEwMCwKICAgICAgbWF4UGF0dGVybkxlbmd0aDogMzIsCiAgICAgIG1pbk1hdGNoQ2hhckxlbmd0aDogMSwKICAgICAga2V5czogWwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICd0aXRsZScsCiAgICAgICAgICB3ZWlnaHQ6IDAuNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbmFtZTogJ3BhdGgnLAogICAgICAgICAgd2VpZ2h0OiAwLjMKICAgICAgICB9CiAgICAgIF0KICAgIH0pCiAgfQoKICAvLyBGaWx0ZXIgb3V0IHRoZSByb3V0ZXMgdGhhdCBjYW4gYmUgZGlzcGxheWVkIGluIHRoZSBzaWRlYmFyCiAgLy8gQW5kIGdlbmVyYXRlIHRoZSBpbnRlcm5hdGlvbmFsaXplZCB0aXRsZQogIHByaXZhdGUgZ2VuZXJhdGVSb3V0ZXMoCiAgICByb3V0ZXM6IFJvdXRlQ29uZmlnW10sCiAgICBiYXNlUGF0aCA9ICcvJywKICAgIHByZWZpeFRpdGxlOiBzdHJpbmdbXSA9IFtdCiAgKSB7CiAgICBsZXQgcmVzOiBSb3V0ZUNvbmZpZ1tdID0gW10KCiAgICBmb3IgKGNvbnN0IHJvdXRlciBvZiByb3V0ZXMpIHsKICAgICAgLy8gc2tpcCBoaWRkZW4gcm91dGVyCiAgICAgIGlmIChyb3V0ZXIubWV0YSAmJiByb3V0ZXIubWV0YS5oaWRkZW4pIHsKICAgICAgICBjb250aW51ZQogICAgICB9CgogICAgICBjb25zdCBkYXRhOiBhbnkgPSB7CiAgICAgICAgcGF0aDogcGF0aC5yZXNvbHZlKGJhc2VQYXRoLCByb3V0ZXIucGF0aCksCiAgICAgICAgbWV0YTogewogICAgICAgICAgdGl0bGU6IFsuLi5wcmVmaXhUaXRsZV0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChyb3V0ZXIubWV0YSAmJiByb3V0ZXIubWV0YS50aXRsZSkgewogICAgICAgIC8vIGdlbmVyYXRlIGludGVybmF0aW9uYWxpemVkIHRpdGxlCiAgICAgICAgY29uc3QgaTE4bnRpdGxlID0gaTE4bi50KGByb3V0ZS4ke3JvdXRlci5tZXRhLnRpdGxlfWApLnRvU3RyaW5nKCkKICAgICAgICBkYXRhLm1ldGEudGl0bGUgPSBbLi4uZGF0YS5tZXRhPy50aXRsZSwgaTE4bnRpdGxlXQogICAgICAgIGlmIChyb3V0ZXIucmVkaXJlY3QgIT09ICdub1JlZGlyZWN0JykgewogICAgICAgICAgLy8gb25seSBwdXNoIHRoZSByb3V0ZXMgd2l0aCB0aXRsZQogICAgICAgICAgLy8gc3BlY2lhbCBjYXNlOiBuZWVkIHRvIGV4Y2x1ZGUgcGFyZW50IHJvdXRlciB3aXRob3V0IHJlZGlyZWN0CiAgICAgICAgICByZXMucHVzaChkYXRhKQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gcmVjdXJzaXZlIGNoaWxkIHJvdXRlcwogICAgICBpZiAocm91dGVyLmNoaWxkcmVuKSB7CiAgICAgICAgY29uc3QgdGVtcFJvdXRlcyA9IHRoaXMuZ2VuZXJhdGVSb3V0ZXMoCiAgICAgICAgICByb3V0ZXIuY2hpbGRyZW4sCiAgICAgICAgICBkYXRhLnBhdGgsCiAgICAgICAgICBkYXRhLm1ldGEudGl0bGUKICAgICAgICApCiAgICAgICAgaWYgKHRlbXBSb3V0ZXMubGVuZ3RoID49IDEpIHsKICAgICAgICAgIHJlcyA9IFsuLi5yZXMsIC4uLnRlbXBSb3V0ZXNdCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICBwcml2YXRlIHF1ZXJ5U2VhcmNoKHF1ZXJ5OiBzdHJpbmcpIHsKICAgIGlmIChxdWVyeSAhPT0gJycpIHsKICAgICAgaWYgKHRoaXMuZnVzZSkgewogICAgICAgIHRoaXMub3B0aW9ucyA9IHRoaXMuZnVzZS5zZWFyY2gocXVlcnkpCiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMub3B0aW9ucyA9IFtdCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAiCA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/HeaderSearch","sourcesContent":["<template>\n  <div\n    id=\"header-search\"\n    :class=\"{'show': show}\" \n    class=\"header-search\"\n  >\n    <svg-icon\n      class=\"search-icon\"\n      name=\"search\"\n      @click.stop=\"click\"\n    />\n    <el-select\n      ref=\"headerSearchSelect\"\n      v-model=\"search\"\n      :remote-method=\"querySearch\"\n      filterable\n      default-first-option\n      remote\n      placeholder=\"Search\"\n      class=\"header-search-select\"\n      @change=\"change\"\n    >\n      <el-option\n        v-for=\"item in options\"\n        :key=\"item.path\"\n        :value=\"item\"\n        :label=\"item.meta.title.join(' > ')\"\n      />\n    </el-select>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport path from 'path'\nimport Fuse from 'fuse.js' // A lightweight fuzzy-search module\nimport { Component, Vue, Watch } from 'vue-property-decorator'\nimport { RouteConfig } from 'vue-router'\nimport { AppModule } from '@/store/modules/app'\nimport { PermissionModule } from '@/store/modules/permission'\nimport i18n from '@/lang' // Internationalization\n\n@Component({\n  name: 'HeaderSearch'\n})\nexport default class extends Vue {\n  private search = '';\n  private show = false;\n  private options: RouteConfig[] = [];\n  private searchPool: RouteConfig[] = [];\n  private fuse?: Fuse<RouteConfig, {}>;\n\n  get routes() {\n    return PermissionModule.routes\n  }\n\n  get lang() {\n    return AppModule.language\n  }\n\n  @Watch('lang')\n  private onLangChange() {\n    this.searchPool = this.generateRoutes(this.routes)\n  }\n\n  @Watch('routes')\n  private onRoutesChange() {\n    this.searchPool = this.generateRoutes(this.routes)\n  }\n\n  @Watch('searchPool')\n  private onSearchPoolChange(value: RouteConfig[]) {\n    this.initFuse(value)\n  }\n\n  @Watch('show')\n  private onShowChange(value: boolean) {\n    if (value) {\n      document.body.addEventListener('click', this.close)\n    } else {\n      document.body.removeEventListener('click', this.close)\n    }\n  }\n\n  mounted() {\n    this.searchPool = this.generateRoutes(this.routes)\n  }\n\n  private click() {\n    this.show = !this.show\n    if (this.show) {\n      this.$refs.headerSearchSelect &&\n        (this.$refs.headerSearchSelect as HTMLElement).focus()\n    }\n  }\n\n  private close() {\n    this.$refs.headerSearchSelect &&\n      (this.$refs.headerSearchSelect as HTMLElement).blur()\n    this.options = []\n    this.show = false\n  }\n\n  private change(route: RouteConfig) {\n    this.$router.push(route.path)\n    this.search = ''\n    this.options = []\n    this.$nextTick(() => {\n      this.show = false\n    })\n  }\n\n  private initFuse(list: RouteConfig[]) {\n    this.fuse = new Fuse(list, {\n      shouldSort: true,\n      threshold: 0.4,\n      location: 0,\n      distance: 100,\n      maxPatternLength: 32,\n      minMatchCharLength: 1,\n      keys: [\n        {\n          name: 'title',\n          weight: 0.7\n        },\n        {\n          name: 'path',\n          weight: 0.3\n        }\n      ]\n    })\n  }\n\n  // Filter out the routes that can be displayed in the sidebar\n  // And generate the internationalized title\n  private generateRoutes(\n    routes: RouteConfig[],\n    basePath = '/',\n    prefixTitle: string[] = []\n  ) {\n    let res: RouteConfig[] = []\n\n    for (const router of routes) {\n      // skip hidden router\n      if (router.meta && router.meta.hidden) {\n        continue\n      }\n\n      const data: any = {\n        path: path.resolve(basePath, router.path),\n        meta: {\n          title: [...prefixTitle]\n        }\n      }\n\n      if (router.meta && router.meta.title) {\n        // generate internationalized title\n        const i18ntitle = i18n.t(`route.${router.meta.title}`).toString()\n        data.meta.title = [...data.meta?.title, i18ntitle]\n        if (router.redirect !== 'noRedirect') {\n          // only push the routes with title\n          // special case: need to exclude parent router without redirect\n          res.push(data)\n        }\n      }\n\n      // recursive child routes\n      if (router.children) {\n        const tempRoutes = this.generateRoutes(\n          router.children,\n          data.path,\n          data.meta.title\n        )\n        if (tempRoutes.length >= 1) {\n          res = [...res, ...tempRoutes]\n        }\n      }\n    }\n    return res\n  }\n\n  private querySearch(query: string) {\n    if (query !== '') {\n      if (this.fuse) {\n        this.options = this.fuse.search(query)\n      }\n    } else {\n      this.options = []\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.header-search {\n  font-size: 0 !important;\n\n  .search-icon {\n    cursor: pointer;\n    font-size: 18px;\n    vertical-align: middle;\n  }\n\n  .header-search-select {\n    font-size: 18px;\n    transition: width 0.2s;\n    width: 0;\n    overflow: hidden;\n    background: transparent;\n    border-radius: 0;\n    display: inline-block;\n    vertical-align: middle;\n\n    .el-input__inner {\n      border-radius: 0;\n      border: 0;\n      padding-left: 0;\n      padding-right: 0;\n      box-shadow: none !important;\n      border-bottom: 1px solid #d9d9d9;\n      vertical-align: middle;\n    }\n  }\n\n  &.show {\n    .header-search-select {\n      width: 210px;\n      margin-left: 10px;\n    }\n  }\n}\n</style>\n"]}]}